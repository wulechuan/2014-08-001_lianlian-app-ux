<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8" />
	<title>lianlian welcome testing</title>
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="stylesheet" href="../stylesheets/lly-animation-toolkits.css" />
	<link rel="stylesheet" href="../stylesheets/lly-animation-toolkits-debug.css" />
	<link rel="stylesheet" href="../stylesheets/app-welcome-stage.css" />
	<link rel="stylesheet" href="../stylesheets/app-welcome-movie.css" />

	<script src="../scripts/jquery-1.11.1.min.js"></script>
	<script src="../scripts/wlc-website.js"></script>

	<style id="style-temp">
		html, body {
			margin: 0;
			padding: 0;
			background-color: black;
		}

		#stage-viewport {
			position: fixed;
			width: 100%;
			height: 100%;
			left: 0;
			top: 0;
			margin: 0;
			padding: 0;
			overflow-x: auto;
			overflow-y: hidden;
		}

		#stage-viewport #stage {
			position: absolute;
			height: 100%;
			overflow: hidden;

			left: 0;
			bottom: 0;
			margin: 0;
			padding: 0;
		}

		#stage-viewport #stage #stage-content-scaler {
			width: 4480px;
			height: 717px;
			
			position: absolute;
			left: 0;
			bottom: 0;
			transform-origin: 0 100% 0;

			margin: 0;
			padding: 0;
		}

		#info {
			display: none;
			position: fixed;
			left: 0;
			top: 0;
			margin: 10px;
			padding: 10px;
			z-index: 100;
			background-color: rgba(255,255,255,0.87);
			color: black;
		}
	</style>
</head>
<body>
<section data-wa-role="resources-loader" id="resources-loader-0">
	<i class="locator face-sweat-droplets"	><i class="size"><i class="symbol"></i></i></i>
	<i class="locator head smiling"			><i class="size"><i class="symbol"></i></i></i>
	<i class="locator head eyes-closed"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator arm l default"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator arm r default"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator arm walking-front"	><i class="size"><i class="symbol"></i></i></i>
	<i class="locator leg default"			><i class="size"><i class="symbol"></i></i></i>
	<i class="locator leg walking-rear"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator pants"				><i class="size"><i class="symbol"></i></i></i>
	<i class="locator trunk"				><i class="size"><i class="symbol"></i></i></i>
	<i class="locator phone-in-hand"		><i class="size"><i class="symbol"></i></i></i>
</section>

<section id="stage-viewport">
	<section id="stage">
		<i id="stage-content-scaler">
			<section id="background-items">
				<i class="locator bg-gradient"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>
				<i class="locator bg-buildings"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>
				<i class="locator bg-road"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>
			</section>

			<section id="all-scenarios">
				<section id="scenario-1">
					<i class="locator scenario-center">
						<i class="locator element-cloud"  id="cloud-1"	><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator element-cloud"  id="cloud-2"	><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator element-cloud"  id="cloud-3"	><i class="size"><i class="symbol pivot bottom"></i></i></i>

						<i class="locator bus-stop-pole"						><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator bus-stop-trash-bin"					><i class="size"><i class="symbol pivot bottom"></i></i></i>
					</i>
				</section>

				<section id="scenario-2">
					<i class="locator scenario-center">
						<i class="locator hotel">
							<i class="locator brand"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="size"><i class="symbol pivot bottom"></i></i>
						</i>
						
						<i class="locator coffee-shop">
							<i class="locator brand"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="size"><i class="symbol pivot bottom"></i></i>
						</i>
					</i>
					
				</section>

				<section id="scenario-3">
					<i class="locator scenario-center">
						<i class="locator outdoor-seats">
							<i class="locator base"		><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator boy"		><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator girl"		><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator umbrella"	><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator table"	><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator waitress">
								<i class="locator voice"><i class="size"><i class="symbol pivot"></i></i></i>
								<i class="size"><i class="symbol pivot bottom"></i></i>
							</i>
						</i>
					</i>
				</section>

				<section id="scenario-4">
					<i class="locator scenario-center">
						<i class="locator gigantic-phone">
							<i class="locator boy"><i class="size"><i class="symbol pivot bottom-right"></i></i></i>
							<i class="locator girl"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>

							<i class="size"><i class="symbol pivot bottom"></i></i>
						</i>

						<i class="locator element-tree"  id="gigantic-phone-tree-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator element-tree"  id="gigantic-phone-tree-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
					</i>
				</section>

				<section id="scenario-5">
					<i class="locator scenario-center">
						<i class="locator green-land">
							<i class="locator building-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator building-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator building-twins">
								<i class="locator tower-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
								<i class="locator tower-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							</i>

							<i class="size"><i class="symbol pivot bottom"></i></i>

							<i class="locator element-wifi-hotspot"  id="green-land-wifi-1"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-2"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-3"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-4"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-5"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-6"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-7"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-8"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-9"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-10"><i class="size small"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator element-tree"  id="green-land-tree-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-tree"  id="green-land-tree-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-tree"  id="green-land-tree-3"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-tree"  id="green-land-tree-4"><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator element-wifi-hotspot"  id="green-land-wifi-hero"><i class="size"><i class="symbol pivot bottom"></i></i></i>
						</i>
					</i>
				</section>
			</section>

			<section id="foreground-items">
				<i class="locator actress walking">
					<!-- <i class="size" data-wa-role="fake-bbox" style="width: 185px; height: 357px"><i class="pivot bottom debug show-bbox"></i></i> -->

					<i class="locator" data-wa-role="pelvis" style="left: 7px; top: -57px;">
						<i class="locator pants">

							<i class="locator leg l default"><i class="size"><i class="symbol pivot top"></i></i></i>
							<i class="locator leg r default"><i class="size"><i class="symbol pivot top"></i></i></i>

							<i class="size"><i class="symbol pivot"></i></i>

							<i class="locator trunk">

								<i class="locator arm l walking-front"><i class="size"><i class="symbol pivot top"></i></i></i>

								<i class="size"><i class="symbol pivot bottom"></i></i>

								<i class="locator head eyes-closeds smiling">
									<i class="size"><i class="symbol pivot bottom"></i></i>
									<i class="locator face-sweat-droplets"><i class="size"><i class="symbol pivot"></i></i></i>
								</i>

								<i class="locator arm r walking-front">
									<i class="locator phone-in-hand"><i class="size"><i class="symbol pivot"></i></i></i>
									<i class="size"><i class="symbol pivot top"></i></i>
								</i>
							</i>
						</i>
					</i>
				</i>

				<i class="locator element-vehicle-blue" id="car-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
				<i class="locator element-vehicle-lime" id="car-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
				<i class="locator element-vehicle-pink" id="car-3"><i class="size"><i class="symbol pivot bottom"></i></i></i>
				<i class="locator element-vehicle-red"  id="car-4"><i class="size"><i class="symbol pivot bottom"></i></i></i>
			</section>
		</i>
	</section>
</section>

<script id="script-definitions">
	if (!window.console) { // IE8 does NOT init console object until the F12 tool is activated.
		window.console = {};
		window.console.log = function () {};
		window.console.warn = function () {};
		window.console.error = function () {};
	}

	window.l = window.console.log.bind(window.console);
	window.w = window.console.warn.bind(window.console);
	window.e = window.console.error.bind(window.console);

	window.qS = document.body.querySelector.bind(document.body);
	window.qSA = document.body.querySelectorAll.bind(document.body);


	function getScrollBarDimension() {
		var _s1 = 123;
		var _s2 = 234;
		var w1=NaN,w2=NaN,h1=NaN,h2=NaN;

		var outer = document.createElement('div');
		var inner = document.createElement('div');

		outer.appendChild(inner);
		document.body.appendChild(outer);

		outer.style.visibility = 'hidden';
		outer.style.position = 'absolute';
		outer.style.top = '0';
		outer.style.left = '0';
		outer.style.overflow = 'scroll';

		outer.style.width = _s1+'px';
		outer.style.height = _s1+'px';

		inner.style.width = _s2+'px';
		inner.style.height = _s2+'px';

		w1 = outer.clientWidth;
		h1 = outer.clientHeight;
		w2 = outer.offsetWidth;
		h2 = outer.offsetHeight;

		outer.removeChild(inner);
		document.body.removeChild(outer);
		delete inner;
		delete outer;

		return {
			vScrollBarWidth: w2 - w1,
			hScrollBarHeight: h2 - h1
		};
	}

	function getRealStyleOf(e) {
		return document.defaultView.getComputedStyle(e,null);
	}

	function pauseAnimationOf(e) {
		if (!e) return false;
		e.animationIsRunning = false;
		e.style.webkitAnimationPlayState = 'paused';
		e.style.animationPlayState = 'paused';
	}

	function resumeAnimationOf(e) {
		if (!e) return false;
		e.animationIsRunning = true;
		e.style.webkitAnimationPlayState = 'running';
		e.style.animationPlayState = 'running';
	}

	function toggleAnimationOf(e) {
		if (!e) return false;
		if (typeof e.animationIsRunning === 'undefined') e.animationIsRunning = true;
		if (e.animationIsRunning) {
			pauseAnimationOf(e);
		} else {
			resumeAnimationOf(e);
		}
	}





	function Stage (options) {
		// --- provided values -------------------
		this.viewport =						null;
		this.stageElement =					null;
		this.stageContentScaler =			null;

		this.viewportWidth =				NaN;
		this.viewportHeight =				NaN;

		this.stageWidthAtFullScale =		NaN;
		this.stageHeightAtFullScale =		NaN;
		

		// --- derived values --------------------
		this.useCssZoom =					false;
		this.stageContentScale =			1;
		this.stageWidthForScaledContent =	NaN;
		this.stageHeightForScaledContent =	NaN;
		this.viewportWidthRemapped =		NaN; // remapped back to unscaled stage content
		this.stageScrollingWidth =			NaN;
		this.stageScrollingWidthRemapped =	NaN;

		this.elapsed = 0;
		this.elapsedRemapped = 0;
		this.elapsedRemappedMiddle = NaN;
		this.elapsedRemappedRight = NaN;
		this.elapsedRatio = 0;


		this.config = function (options) {
			var _ok = true;
			var _ = options || {};

			var _viewport = 			document.getElementById(_.viewportId);
			var _stageElement = 		document.getElementById(_.stageId);
			var _stageContentScaler = 	document.getElementById(_.stageContentScalerId);

			if (_viewport)				{ this.viewport = 			document.getElementById(_.viewportId); }
			if (_stageElement)			{ this.stageElement = 		document.getElementById(_.stageId); }
			if (_stageContentScaler)	{ this.stageContentScaler =	document.getElementById(_.stageContentScalerId); }

			var _w = Number(_.stageWidthAtFullScale);
			var _h = Number(_.stageHeightAtFullScale);

			if (!this.viewport) {
				_ok = false;
				e('Invalid html id for Stage.viewport.', '\n\tThe html id provided:', _.viewportId);
				// return false;
			}

			if (!this.stageElement) {
				_ok = false;
				e('Invalid html id for Stage.stageElement.', '\n\tThe html id provided:', _.stageId);
				// return false;
			}

			if (!this.stageContentScaler) {
				_ok = false;
				e('Invalid html id for Stage.stageContentScaler.', '\n\tThe html id provided:', _.stageContentScalerId);
				// return false;
			}

			if (!this.stageWidthAtFullScale && !_w) {
				_ok = false;
				e('Invalid stage width.', '\n\tThe width value provided:', _.stageWidthAtFullScale);
				// return false;
			}

			if (!this.stageHeightAtFullScale && !_h) {
				_ok = false;
				e('Invalid stage height.', '\n\tThe height value provided:', _.stageHeightAtFullScale);
				// return false;
			}

			if (!_ok) {
				return false;
			}




			if (_w) { this.stageWidthAtFullScale = _w; }
			if (_h) { this.stageHeightAtFullScale = _h; }




			_w = Number(_.viewportWidth);
			_h = Number(_.viewportHeight);

			this.viewportWidth =	!_w ? document.documentElement.clientWidth  : Math.min(document.documentElement.clientWidth, _w);
			this.viewportHeight =	!_h ? document.documentElement.clientHeight : Math.min(document.documentElement.clientHeight, _h);

			if (_w) {
				this.viewport.style.width = this.viewportWidth + 'px';
			}
			if (_h) {
				this.viewport.style.height = this.viewportHeight + 'px';
			}

			this.stageHeightForScaledContent = this.viewportHeight;

			var _hasHorizontalScrollBar = website.env.mode.desktop;

			if (_hasHorizontalScrollBar) {
				this.stageHeightForScaledContent = this.stageHeightForScaledContent - getScrollBarDimension().hScrollBarHeight;
			}



			this.stageContentScale = this.stageHeightForScaledContent / this.stageHeightAtFullScale;
			this.stageWidthForScaledContent = Math.floor( this.stageWidthAtFullScale * this.stageContentScale );
			
			this.viewportWidthRemapped = this.viewportWidth / this.stageContentScale;

			this.stageScrollingWidth = Math.max(0, this.stageWidthForScaledContent - this.viewportWidth);
			this.stageScrollingWidthRemapped = this.stageScrollingWidth / this.stageContentScale;




			this.useCssZoom = (website.env.os.ios || website.env.ua.safari) && !website.env.os.wp;

			if (this.useCssZoom) {
				this.stageContentScaler.style.zoom = this.stageContentScale;
			} else {
				this.stageContentScaler.style.transform = 		'scale3d('+this.stageContentScale+', '+this.stageContentScale+', '+0.999+')';
				this.stageContentScaler.style.webkitTransform =	'scale3d('+this.stageContentScale+', '+this.stageContentScale+', '+0.999+')';

				// this.stageContentScaler.style.transform = 		'scale('+this.stageContentScale+', '+this.stageContentScale+')';
				// this.stageContentScaler.style.webkitTransform =	'scale('+this.stageContentScale+', '+this.stageContentScale+')';
			}

			this.stageElement.style.width = this.stageWidthForScaledContent + 'px';
		}

		this.reset = function () {
			this.playTo(0);
			this.viewport.scrollLeft = 0;
		}

		this.playTo = function (elapsed) {
			if (!isNaN(Number(elapsed))) { this.elapsed = Number(elapsed); }
			this.elapsedRemapped = this.elapsed / this.stageContentScale;
			this.elapsedRemappedMiddle = this.elapsedRemapped + this.viewportWidthRemapped * 0.5;
			this.elapsedRemappedRight = this.elapsedRemapped + this.viewportWidthRemapped;
			this.elapsedRatio = this.elapsedRemapped / this.stageScrollingWidthRemapped;

			// l(this.elapsedRatio, '\t', this.elapsed + this.viewportWidthRemapped);

			return this.elapsedRatio;
		}

		this.play = function () {
			return this.playTo(this.viewport.scrollLeft);
		}

		this.config(options);
	} // CLASS:Stage




	function Actor (locator, options) {
		this.status = 0;
		if (!locator || !locator.className || !locator.className.toLowerCase().indexOf('locator')<0) {
			e('Invalid locator element for new Actor. Actor NOT created.');
			return false;
		}

		this.locator = locator;
		this.actions = [];

		this.reset = function () {
			this.status = 0;
		}

		this.doAction = function (actionId) {
			this.actions[actionId].call(this);
			this.status = 1;
		}

		this.defineAction = function (actionId, action) {
			if (typeof action != 'function') {
				e('Invalid function provided when trying defining an action of actor', this.locator);
				return false;
			}
			this.actions[actionId] = action;
		}
	} // CLASS:Actor




	function MovieTriggerdAction(movie, actor, options) {
		// movie:						<object of CLASS:Movie>
		// actor:						<object of CLASS:Actor>

		if (!movie) {
			e('Invalid movie for a MovieTriggerdAction.', '\n\tProvided movie:', movie);
			return false;
		}

		if (!actor) {
			e('Invalid actor for a MovieTriggerdAction.', '\n\tProvided actor:', actor);
			return false;
		}

		this.actor = actor;

		this.triggerForward = {
			triggered: false,
			enabled: false,
			elapsed: NaN,
			actionId: '',
		};

		this.triggerBackward = {
			triggered: true,
			enabled: false,
			elapsed: NaN,
			actionId: '',
		};

		this.onTrigger = function (trigger) {}
		this.onTriggerForward = function () {}
		this.onTriggerBackward = function () {}


		this.config = function(options) {
			// options.triggerForward:		'disabled'|'no'|NaN|'enabled'|'yes'|'auto'|<Valid Number>;
			// options.triggerBackward:		'disabled'|'no'|NaN|'enabled'|'yes'|'auto'|<Valid Number>;
			//
			//								'disabled':		disable backward trigger
			//								'no':			disable backward trigger
			//								NaN:			disable backward trigger
			//
			//								'enabled':		triggerForward + viewportWidthRemapped/2 | triggerBackward - viewportWidthRemapped/2
			//								'yes':			triggerForward + viewportWidthRemapped/2 | triggerBackward - viewportWidthRemapped/2
			//								'auto':			triggerForward + viewportWidthRemapped/2 | triggerBackward - viewportWidthRemapped/2
			//
			//								<Valid Number>:	the number value
			//
			// options.forwardActionId:		<string>;
			// options.backwardActionId:	<string>;
			//
			var _ok = true;
			var _ = options || {};

			var _fEnabled = false;
			var _bEnabled = false;

			var _f = Number(_.triggerForward);
			var _fS = String(_.triggerForward).toLowerCase();

			var _b = Number(_.triggerBackward);
			var _bS = String(_.triggerBackward).toLowerCase();

			var _fValid = !isNaN(_f);
			var _bValid = !isNaN(_b);

			if (!_fValid && !_bValid) {
				_ok = false;
				e(this.actor, 'Neither triggerForward nor triggerBackward is provided specifically.','\n\tProvided triggerForward:', _.triggerForward,'\n\tProvided triggerBackward:', _.triggerBackward);
			} else {

				var _viewportWidth = movie.stage.viewportWidthRemapped;

				if (_fValid) {
					_fEnabled = true;
				}

				if (_fValid && !_bValid) {
					var _bSValid = _bS === 'auto' || _bS === 'yes' || _bS === 'enabled';
					if (_bSValid) {
						_bEnabled = true;
						_b = _f + _viewportWidth/2;
					}
				}

				if (!_fValid && _bValid) {
					var _fSValid = _fS === 'auto' || _fS === 'yes' || _bS === 'enabled';
					if (_fSValid) {
						_fEnabled = true;
						_f = _d - _viewportWidth/2;
					}
				}

				if (_bValid) {
					_bEnabled = true;
					if (_fValid && _b<=_f) {
						w(this.actor, 'TriggerBackward is less than or equals to triggerForward.','\n\tProvided triggerForward:', _.triggerForward,'\n\tProvided triggerBackward:', _.triggerBackward);
					}
				}

			}


			if (_fEnabled && (!_.forwardActionId || typeof _.forwardActionId !== 'string')) {
				_ok = false;
				e('Invalid forwardActionId for a MovieTriggerdAction.', '\n\tProvided forwardActionId:', _.forwardActionId);
			}

			if (_fEnabled && (!_.backwardActionId || typeof _.backwardActionId !== 'string')) {
				_ok = false;
				e('Invalid backwardActionId for a MovieTriggerdAction.', '\n\tProvided backwardActionId:', _.backwardActionId);
			}

			if (!_ok) {
				return false;
			}


			if (!_fEnabled) { _f = NaN; _.forwardActionId = ''; }	// just for sure
			if (!_bEnabled) { _b = NaN; _.backwardActionId = ''; }	// just for sure

			this.triggerForward.enabled = _fEnabled;
			this.triggerForward.elapsed = _f;
			this.triggerForward.actionId = _.forwardActionId;

			this.triggerBackward.enabled = _bEnabled;
			this.triggerBackward.elapsed = _b;
			this.triggerBackward.actionId = _.backwardActionId;

			return this;
		}

		this.tryTrigger = function(moviePlayingForward, movieElapsed) {
			var _t = moviePlayingForward ? this.triggerForward : this.triggerBackward;
			var _tOpp = moviePlayingForward ? this.triggerBackward : this.triggerForward;

			if (_t.enabled && !_t.triggered) {
				var _triggered = moviePlayingForward ? (_t.elapsed <= movieElapsed) : (_t.elapsed >= movieElapsed);

				if (_triggered) {
					// l('"'+this.actor.symbol.id+'"', moviePlayingForward ? 'forward' : 'backward', trigger.elapsed, movieElapsed);
					_t.triggered = true;
					_tOpp.triggered = false;

					this.onTrigger(_t);
					this.actor.doAction(_t.actionId);

					if (moviePlayingForward) {
						this.onTriggerForward(_t);
					} else {
						this.onTriggerBackward(_t);
					}
					return true;
				}
			}

			return false;
		}

		this.tryTriggerForward = function(moviePlayingForward, movieElapsed) {
			return this.tryTrigger(moviePlayingForward, movieElapsed);
		}

		this.tryTriggerBackward = function(moviePlayingForward, movieElapsed) {
			return this.tryTrigger(moviePlayingForward, movieElapsed);
		}
		
		return this.config(options);
	} // CLASS:MovieTriggerdAction




	function Movie(stage, options) {
		this.stage = null;
		this.isPlaying = false;
		this.isPlayingForward = false;
		this.isPaused = false;
		this.elapsedRatio = 0;
		this.elapsedRatioLastTime = 0;
		this.actors = [];
		this.triggeredActions = [];

		this.onStop = function() {};
		this.onPause = function() {};
		this.onResume = function() {};
		this.onPlay = function() {};

		this.config = function (stage, options) {
			if (!stage && !stage.stageElement && !stage.viewportWidth) {
				e('Invalid stage object.');
				return false;
			}

			this.stage = stage;
			this.stageWidth = this.stage.stageScrollingWidthRemapped;
			var _ = options || {};
		}

		this.addActor = function(actorName, locator, options) {
			var _actor = new Actor(locator, options);
			if (_actor) {
				this.actors[actorName] = _actor;
			}
		}

		this.addTriggeredAction = function (actorName, options) {
			var _a = new MovieTriggerdAction(this, this.actors[actorName], options);
			if (_a) {
				this.triggeredActions.push(_a);
				return _a;
			}
		}

		this.stop = function() {
			this.stage.reset();

			for (var i=0; i<this.actors.length;i++) {
				this.actors[i].reset();
			}

			this.isPlaying = false;
			this.isPlayingForward = false;
			this.isPaused = false;

			this.onStop();
		}

		this.pause = function() {
			// if (!this.isPlaying) {
			// 	return false;
			// }
			// this.isPlaying = false;
			// this.isPlayingForward = false;
			// this.isPaused = true;

			this.onPause();
		}

		this.resume = function() {
			// if (!this.isPaused) {
			// 	return false;
			// }
			// this.isPlaying = true;
			// this.isPaused = false;

			this.onResume();
		}

		this.play = function() {
			if (this.isPaused) {
				return false;
			}

			this.onPlay();

			this.isPlaying = true;
			this.isPaused = false;
			this.elapsedRatio = this.stage.play();
			var _elapsed = this.stage.elapsedRemapped;

			this.isPlayingForward = this.elapsedRatio > this.elapsedRatioLastTime;
			// l('isPlayingForward = '+this.isPlayingForward);
			this.elapsedRatioLastTime = this.elapsedRatio;

			for (var i=0; i<this.triggeredActions.length;i++) {
				var _a = this.triggeredActions[i];
				_a.tryTriggerForward(this.isPlayingForward, _elapsed);
				_a.tryTriggerBackward(this.isPlayingForward ,_elapsed);
			}
		}

		this.config(stage, options);
	} // CLASS:Movie
</script>

<script id="script-init">
	var welcomeStage = new Stage({
		viewportId:				'stage-viewport',
		stageId:				'stage',
		stageContentScalerId:	'stage-content-scaler',

		// viewportWidth:			320,
		// viewportHeight:			480,

		stageWidthAtFullScale:	4480,
		stageHeightAtFullScale:	717
	});

	var welcomeMovie = new Movie(welcomeStage);
</script>

<script id="script-test-and-debug-1">
	if (website.env.mode.desktop && !website.env.os.wp) {
		welcomeStage.config({
			viewportWidth: 500-17,
			viewportHeight: 500,
		});
		welcomeStage.viewport.style.position = 'relative';
		welcomeStage.viewport.style.marginLeft = 'auto';
		welcomeStage.viewport.style.marginRight = 'auto';
		welcomeStage.viewport.style.marginTop = '200px';
	}
</script>

<script id="script-story-teller">
	welcomeMovie.addActor('cloud-1', qS('#cloud-1'));
	welcomeMovie.addActor('cloud-2', qS('#cloud-2'));
	welcomeMovie.addActor('cloud-3', qS('#cloud-3'));

	var actorActionsLib = {
		cloudFlyForward: function () {
			l(this.locator.id, 'cloudFlyForward');
			var _cssAni = 'wak-cloud-fly 2s ease-in-out 0s 1 normal forwards';
			this.locator.style.webkitAnimation = '';
			this.locator.style.animation = '';
			this.locator.style.webkitAnimation = _cssAni;
			this.locator.style.animation = _cssAni;
			// this.locator.classList.remove('fly-backward');
			// this.locator.classList.add('fly-forward');
		},
		cloudFlyBackward: function () {
			l(this.locator.id, 'cloudFlyBackward');
			var _cssAni = 'wak-cloud-fly 2s ease-in-out 0s 1 reverse backwards';
			this.locator.style.webkitAnimation = '';
			this.locator.style.animation = '';
			this.locator.style.webkitAnimation = _cssAni;
			this.locator.style.animation = _cssAni;
			// this.locator.classList.remove('fly-forward');
			// this.locator.classList.add('fly-backward');
		},
	}

	welcomeMovie.actors['cloud-1'].defineAction('fly-forward', actorActionsLib.cloudFlyForward);
	welcomeMovie.actors['cloud-2'].defineAction('fly-forward', actorActionsLib.cloudFlyForward);
	welcomeMovie.actors['cloud-3'].defineAction('fly-forward', actorActionsLib.cloudFlyForward);

	welcomeMovie.actors['cloud-1'].defineAction('fly-backward', actorActionsLib.cloudFlyBackward);
	welcomeMovie.actors['cloud-2'].defineAction('fly-backward', actorActionsLib.cloudFlyBackward);
	welcomeMovie.actors['cloud-3'].defineAction('fly-backward', actorActionsLib.cloudFlyBackward);

	welcomeMovie.addTriggeredAction( 'cloud-1', { triggerForward:   40, triggerBackward:  150, forwardActionId: 'fly-forward', backwardActionId: 'fly-backward' } );
	welcomeMovie.addTriggeredAction( 'cloud-2', { triggerForward:  100, triggerBackward:  210, forwardActionId: 'fly-forward', backwardActionId: 'fly-backward' } );
	welcomeMovie.addTriggeredAction( 'cloud-3', { triggerForward:   70, triggerBackward:  180, forwardActionId: 'fly-forward', backwardActionId: 'fly-backward' } );
</script>

<script id="script-test-and-debug-2">
	if (1) {
		var _indent = '<br/>&nbsp;&nbsp;';
		var info = document.createElement('H3');
			info.id = 'info';
		document.body.appendChild(info);

		// welcomeMovie.onStop = function () { printDynamicInfo2.call(this.stage); }
		// welcomeMovie.onPlay = function () { printDynamicInfo2.call(this.stage); }
		welcomeMovie.triggeredActions[0].onTrigger = function(trigger) { printTriggeredActionInfo.call(this, trigger) };
	}

	function printDebugInfo() {
		info.innerHTML = ''
			+ 'screen: ' + screen.availWidth + ' x ' + screen.availHeight
			+ '<br/>window: ' + window.innerWidth + ' x ' + window.innerHeight
			+ '<br/>html: ' + document.documentElement.clientWidth + ' x ' + document.documentElement.clientHeight
			+ '<br/>body: ' + document.body.clientWidth + ' x ' + document.body.clientHeight
			+ '<br/>container: ' + getRealStyleOf(this.viewport).width + ' x ' + getRealStyleOf(this.viewport).height
			+ '<br/>'
			+ '<br/>stage dimensions:'
			+ '<br/>&nbsp;&nbsp;&nbsp;&nbsp;desired: ' + this.stageWidthForScaledContent + 'px x ' + this.viewportHeight + 'px'
			+ '<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actual: ' + getRealStyleOf(this.stageElement).width + ' x ' + getRealStyleOf(this.stageElement).height
			+ '<br/>stageScrollingWidth: ' + this.stageScrollingWidth
			+ '<br/>'
			+ '<br/>stageContentScale: ' + Math.round(this.stageContentScale*1000)/1000
			+ '<br/>stageContentScalerInlineStyle:<br/>' + (this.useCssZoom ? ('zoom: '+this.stageContentScaler.style.zoom) : this.stageContentScaler.style.transform)
			;
		info.style.display = 'block';
	}

	function printDynamicInfo(innerHTML) {
		info.innerHTML = innerHTML;
		info.style.display = 'block';
	}

	function printDynamicInfo2() {
		info.innerHTML = ''
			+ 'stage elapsed:'
			+ _indent + 'raw = ' + Math.round(this.elapsed*1000)/1000
			+ _indent + 'Remapped = ' + Math.round(this.elapsedRemapped*1000)/1000
			+ _indent + 'RemappedMiddle = ' + Math.round(this.elapsedRemappedMiddle*1000)/1000
			+ _indent + 'RemappedRight = ' + Math.round(this.elapsedRemappedRight*1000)/1000
			+ _indent + 'Ratio = ' + Math.round(this.elapsedRatio*1000)/1000
			+ '<br/>Movie:'
			+ _indent + 'isPlayingForward = ' + welcomeMovie.isPlayingForward
			;
		info.style.display = 'block';
	}

	function printTriggeredActionInfo(trigger) {
		// l(this.actor.locator);
		printDynamicInfo( this.actor.locator.id+'<br/>'+trigger.actionId+'<br/>elapsed = '+trigger.elapsed+'/'+welcomeMovie.stage.elapsedRemapped );
	}
</script>

<script id="script-play-movie">
	var tempResLoader = document.getElementById('resources-loader-0');
	if (tempResLoader) {
		tempResLoader.innerHTML = '';
		tempResLoader.parentNode.removeChild(tempResLoader);
	}
	delete tempResLoader;

	welcomeMovie.stop();
	welcomeStage.viewport.addEventListener('scroll', function (e) { welcomeMovie.play(); });
</script>
</body>
</html>