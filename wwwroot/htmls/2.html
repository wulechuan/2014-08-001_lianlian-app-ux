<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8" />
	<title>animation toolkit testing</title>
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="stylesheet" href="../stylesheets/lly-animation-toolkits.css" />
	<link rel="stylesheet" href="../stylesheets/lly-animation-toolkits-debug.css" />
	<link rel="stylesheet" href="../stylesheets/app-welcome.css" />

	<script src="../scripts/jquery-1.11.1.min.js"></script>

	<style id="style-temp">
		html, body {
			margin: 0;
			padding: 0;
		}

		#stage-container {
			position: fixed;
			width: 100%;
			height: 100%;
			left: 0;
			top: 0;
			margin: 0;
			padding: 0;
			overflow-x: auto;
			overflow-y: hidden;
		}

		#stage-container #stage {
			position: absolute;
			height: 100%;
			left: 0;
			bottom: 0;
			margin: 0;
			padding: 0;
		}

		#stage-container #stage #stage-scaler {
			width: 4480px;
			height: 717px;
			overflow: hidden;
			
			position: absolute;
			left: 0;
			bottom: 0;
			transform-origin: 0 100% 0;

			margin: 0;
			padding: 0;
		}

		#info {
			position: fixed;
			left: 0;
			top: 0;
			margin: 10px;
			padding: 10px;
			z-index: 100;
			background-color: rgba(255,255,255,0.6);
			color: black;
		}
	</style>
</head>
<body>
<section data-wa-role="resources-loader" id="resources-loader-0">
	<i class="locator face-sweat-droplets"	><i class="size"><i class="symbol"></i></i></i>
	<i class="locator head smiling"			><i class="size"><i class="symbol"></i></i></i>
	<i class="locator head eyes-closed"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator arm l default"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator arm r default"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator arm walking-front"	><i class="size"><i class="symbol"></i></i></i>
	<i class="locator leg default"			><i class="size"><i class="symbol"></i></i></i>
	<i class="locator leg walking-rear"		><i class="size"><i class="symbol"></i></i></i>
	<i class="locator pants"				><i class="size"><i class="symbol"></i></i></i>
	<i class="locator trunk"				><i class="size"><i class="symbol"></i></i></i>
	<i class="locator phone-in-hand"		><i class="size"><i class="symbol"></i></i></i>
</section>

<section id="stage-container">
	<section id="stage">
		<i id="stage-scaler">
			<section id="background-items">
				<i class="locator bg-gradient"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>
				<i class="locator bg-buildings"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>
				<i class="locator bg-road"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>
			</section>

			<section id="all-scenarios">
				<section id="scenario-1">
					<i class="locator scenario-center">
						<i class="locator element-cloud"  id="bus-stop-cloud-1"	><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator element-cloud"  id="bus-stop-cloud-2"	><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator element-cloud"  id="bus-stop-cloud-3"	><i class="size"><i class="symbol pivot bottom"></i></i></i>

						<i class="locator bus-stop-pole"						><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator bus-stop-trash-bin"					><i class="size"><i class="symbol pivot bottom"></i></i></i>
					</i>
				</section>

				<section id="scenario-2">
					<i class="locator scenario-center">
						<i class="locator hotel">
							<i class="locator brand"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="size"><i class="symbol pivot bottom"></i></i>
						</i>
						
						<i class="locator coffee-shop">
							<i class="locator brand"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="size"><i class="symbol pivot bottom"></i></i>
						</i>
					</i>
					
				</section>

				<section id="scenario-3">
					<i class="locator scenario-center">
						<i class="locator outdoor-seats">
							<i class="locator base"		><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator boy"		><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator girl"		><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator umbrella"	><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator table"	><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator waitress">
								<i class="locator voice"><i class="size"><i class="symbol pivot"></i></i></i>
								<i class="size"><i class="symbol pivot bottom"></i></i>
							</i>
						</i>
					</i>
				</section>

				<section id="scenario-4">
					<i class="locator scenario-center">
						<i class="locator gigantic-phone">
							<i class="locator boy"><i class="size"><i class="symbol pivot bottom-right"></i></i></i>
							<i class="locator girl"><i class="size"><i class="symbol pivot bottom-left"></i></i></i>

							<i class="size"><i class="symbol pivot bottom"></i></i>
						</i>

						<i class="locator element-tree"  id="gigantic-phone-tree-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
						<i class="locator element-tree"  id="gigantic-phone-tree-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
					</i>
				</section>

				<section id="scenario-5">
					<i class="locator scenario-center">
						<i class="locator green-land">
							<i class="locator building-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator building-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator building-twins">
								<i class="locator tower-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
								<i class="locator tower-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							</i>

							<i class="size"><i class="symbol pivot bottom"></i></i>

							<i class="locator element-wifi-hotspot"  id="green-land-wifi-1"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-2"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-3"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-4"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-5"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-6"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-7"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-8"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-9"><i class="size small"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-wifi-hotspot"  id="green-land-wifi-10"><i class="size small"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator element-tree"  id="green-land-tree-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-tree"  id="green-land-tree-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-tree"  id="green-land-tree-3"><i class="size"><i class="symbol pivot bottom"></i></i></i>
							<i class="locator element-tree"  id="green-land-tree-4"><i class="size"><i class="symbol pivot bottom"></i></i></i>

							<i class="locator element-wifi-hotspot"  id="green-land-wifi-hero"><i class="size"><i class="symbol pivot bottom"></i></i></i>
						</i>
					</i>
				</section>
			</section>

			<section id="foreground-items">
				<i class="locator actress walking">
					<!-- <i class="size" data-wa-role="fake-bbox" style="width: 185px; height: 357px"><i class="pivot bottom debug show-bbox"></i></i> -->

					<i class="locator" data-wa-role="pelvis" style="left: 7px; top: -57px;">
						<i class="locator pants">

							<i class="locator leg l default"><i class="size"><i class="symbol pivot top"></i></i></i>
							<i class="locator leg r default"><i class="size"><i class="symbol pivot top"></i></i></i>

							<i class="size"><i class="symbol pivot"></i></i>

							<i class="locator trunk">

								<i class="locator arm l walking-front"><i class="size"><i class="symbol pivot top"></i></i></i>

								<i class="size"><i class="symbol pivot bottom"></i></i>

								<i class="locator head eyes-closeds smiling">
									<i class="size"><i class="symbol pivot bottom"></i></i>
									<i class="locator face-sweat-droplets"><i class="size"><i class="symbol pivot"></i></i></i>
								</i>

								<i class="locator arm r walking-front">
									<i class="locator phone-in-hand"><i class="size"><i class="symbol pivot"></i></i></i>
									<i class="size"><i class="symbol pivot top"></i></i>
								</i>
							</i>
						</i>
					</i>
				</i>

				<i class="locator element-vehicle-blue" id="car-1"><i class="size"><i class="symbol pivot bottom"></i></i></i>
				<i class="locator element-vehicle-lime" id="car-2"><i class="size"><i class="symbol pivot bottom"></i></i></i>
				<i class="locator element-vehicle-pink" id="car-3"><i class="size"><i class="symbol pivot bottom"></i></i></i>
				<i class="locator element-vehicle-red"  id="car-4"><i class="size"><i class="symbol pivot bottom"></i></i></i>
			</section>
		</i>
	</section>
</section>

<h3 id="info"></h3>

<script id="script-definitions">
	var inputPointer = {
		draggingThreshold: 3,
		isDragging: false,
		startX: NaN,
		startY: NaN,
		deltaX: NaN,
		deltaY: NaN,
		distance: NaN,

		startDragging: function (e) {
			// e = e.originalEvent;
			// console.log('start dragging. pageX =', e.pageX, ' pageY =', e.pageY);
			this.isDragging = true;
			this.startX = e.pageX;
			this.startY = e.pageY;
			this.deltaX = 0;
			this.deltaY = 0;
			this.distance = 0;

			cacheLeft.call(stage);
		},

		stopDragging: function (e) {
			// console.log('stop dragging.');
			if (1) {
				this.isDragging = false;
				this.startX = NaN;
				this.startY = NaN;
				this.deltaX = NaN;
				this.deltaY = NaN;
				this.distance = NaN;
			}
		},

		onDragging: function (e) {
			// console.log('mouse or finger moving. pageX =', e.pageX);
			// console.log(this);
			if (!this.isDragging) {
				return true;
			}

			this.deltaX = e.pageX - this.startX;
			this.deltaY = e.pageY - this.startY;
			// _distance = Math.round(Math.sqrt(this.deltaX*this.deltaX+this.deltaY*this.deltaY)*100)/100;
			_distance = Math.abs(this.deltaX);

			if (_distance < this.draggingThreshold) {
				this.distance = 0;
			} else {
				this.distance = _distance;
				// console.log(this.deltaX);
				moveHorizontally.call(stage, this.deltaX);
			}


		}
	};


	function pauseAnimationOf(e) {
		if (!e) return false;
		e.animationIsRunning = false;
		e.style.webkitAnimationPlayState = 'paused';
		e.style.animationPlayState = 'paused';
	}

	function resumeAnimationOf(e) {
		if (!e) return false;
		e.animationIsRunning = true;
		e.style.webkitAnimationPlayState = 'running';
		e.style.animationPlayState = 'running';
	}

	function toggleAnimationOf(e) {
		if (!e) return false;
		if (typeof e.animationIsRunning === 'undefined') e.animationIsRunning = true;
		if (e.animationIsRunning) {
			pauseAnimationOf(e);
		} else {
			resumeAnimationOf(e);
		}
	}

	function cacheLeft() {
		if (typeof this.cacheOnDraggingStart==='undefined') this.cacheOnDraggingStart = {};

		var targetComputedStyle = document.defaultView.getComputedStyle(this, null);
		this.cacheOnDraggingStart.left = parseInt(targetComputedStyle.left);
		this.newLeft = this.cacheOnDraggingStart.left;
		// console.log(this, 'left:', this.cacheOnDraggingStart.left);
	}

	function moveHorizontally(deltaX) {
		this.newLeft = Math.max(stageScrollingXMin, Math.min(0, this.cacheOnDraggingStart.left + inputPointer.deltaX) );
		this.style.left = this.newLeft+'px';
		printInfo.call(this);
	}

	function printInfo(newLeft) {
		// info.innerHTML = 'html id="'+this.id+'"<br/>oldLeft: '+this.cacheOnDraggingStart.left+'<br/>dragging by '+( inputPointer.deltaX ? inputPointer.deltaX : 0 )+'px;<br/>newLeft: '+this.newLeft;
		info.innerHTML = ''
			+ 'window: ' + window.innerWidth + ' x ' + window.innerHeight
			+ '<br/>html: ' + document.documentElement.clientWidth + ' x ' + document.documentElement.clientHeight
			+ '<br/>body: ' + document.body.clientWidth + ' x ' + document.body.clientHeight
			+ '<br/>stageContentScale: ' + Math.round(stageScale*1000)/1000
			+ '<br/>stageWidth: ' + Math.round(stageWidthScaled*1000)/1000
			;
	}
</script>

<script id="script-init">
	var tempResLoader = document.getElementById('resources-loader-0');
	if (tempResLoader) {
		tempResLoader.innerHTML = '';
		tempResLoader.parentNode.removeChild(tempResLoader);
	}
	delete tempResLoader;

	var containerHeight = Math.min(800, document.documentElement.clientHeight);
	var stageHeightAtFulScale = 717;
	var stageWidthAtFulScale = 4480;
	var stageScale = containerHeight / stageHeightAtFulScale;
	var stageWidthScaled = stageWidthAtFulScale * stageScale;
	var stageScrollingXMin = -stageWidthScaled + document.documentElement.clientWidth;



	var stageContainer = document.getElementById('stage-container');
	var stage = document.getElementById('stage');
	var stageScaler = document.getElementById('stage-scaler');

	var info = document.getElementById('info');

	stageScaler.style.transform = 'scale3d('+stageScale+', '+stageScale+', '+stageScale+')';
	stage.style.width = stageWidthScaled + 'px';

	cacheLeft.call(stage);
	printInfo.call(stage);

	var $stage = $(stage);
	var $actress = $('.actress');
</script>

<script id="script-story-teller">
	// $(document.documentElement)
	// 	.on('mousedown',	function (e) { inputPointer.startDragging(e); })
	// 	.on('touchstart',	function (e) { inputPointer.startDragging(e); })

	// 	.on('mouseup',		function (e) { inputPointer.stopDragging(e); })
	// 	.on('touchend',		function (e) { inputPointer.stopDragging(e); })
	// 	.on('touchcancel',	function (e) { inputPointer.stopDragging(e); })

	// 	.on('mousemove',	function (e) { inputPointer.onDragging(e); })
	// 	.on('touchmove',	function (e) { inputPointer.onDragging(e); })
	// 	;
</script>
</body>
</html>